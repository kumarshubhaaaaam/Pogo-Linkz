<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Access Granted</title>
  <style>
    body {
      margin: 0;
      font-family: 'Outfit', sans-serif;
      background: #000;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
    }
    h2 {
      margin-bottom: 10px;
    }
    p {
      font-size: 1.1em;
    }

    @media (max-width: 600px) {
      h2 {
        font-size: 1.8em;
      }
      p {
        font-size: 1.3em;
      }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD0ToOiOy0rxygIiJbulFA1JMqwiGGHBdQ",
    authDomain: "pogoverification.firebaseapp.com",
    databaseURL: "https://pogoverification-default-rtdb.firebaseio.com",
    projectId: "pogoverification",
    storageBucket: "pogoverification.firebasestorage.app",
    messagingSenderId: "809965158927",
    appId: "1:809965158927:web:677ba69861acc49be1d97a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  async function getUserIdentifier() {
    const fp = await FingerprintJS.load();
    const result = await fp.get();
    const fingerprint = result.visitorId;
    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    return `${ipData.ip}_${fingerprint}`;
  }
</script>
</head>
<body>
  <h2>Access Granted</h2>
  <p>Redirecting to your stream content...</p>

 <script>
    const expiresAt = Date.now() + (24 * 60 * 60 * 1000);
getUserIdentifier().then(uid => {
  db.ref("verifiedUsers/" + uid).set({
    verified: true,
    expiresAt: expiresAt
  });
});
    // ✅ Main verification storage: localStorage
    localStorage.setItem('verifiedUntil', expiresAt);

    // 🍪 Cookie set kar rahe hain sirf optional extra ke liye
    const expireDate = new Date(expiresAt).toUTCString();
    document.cookie = "verified_access=true; expires=" + expireDate + "; path=/";

    const params = new URLSearchParams(window.location.search);
    const rawUrl = params.get('url') || '';
    const title = params.get('title');

    let target = `/stream.html?url=${encodeURIComponent(rawUrl)}`;
    if (title) {
      target += `&title=${encodeURIComponent(title)}`;
    }

    setTimeout(() => {
      window.location.href = target;
    }, 2000);
</script>
</body>
</html>
